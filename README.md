# AI-agent-RAG  
Introducing research items on AI agent RAG.

## 1장 Agentic RAG 개요

Agentic Retrieval-Augmented Generation(Agentic RAG)은 최신 인공지능 시스템 설계에서 부상하고 있는 개념으로, **대형 언어 모델(LLM)**이 단순히 정보를 생성하는 것을 넘어, 외부 정보원을 적극적으로 활용하면서 스스로 다음 행동을 계획하는 구조를 갖습니다.

기존의 RAG(Retrieval-Augmented Generation)는 '질문 → 검색 → 응답 생성'이라는 고정된 흐름을 따릅니다. 반면, Agentic RAG는 다음과 같은 반복적이고 동적인 루프 구조를 중심으로 작동합니다:

- 사용자의 요청(prompt)을 인식  
- 필요한 정보를 스스로 판단해 적절한 검색 도구(벡터 검색, SQL 등)를 선택  
- 검색된 정보를 평가하고, 부족하거나 부정확할 경우 쿼리를 재작성  
- 여러 도구를 반복 활용하며 결과를 보완  
- 충분히 정제된 해답에 도달할 때까지 위 과정을 반복

이로 인해 Agentic RAG는 단순한 생성기에서 **의사결정 능력을 가진 지능형 시스템**으로 발전합니다.

---

## 2장 핵심 구조와 작동 방식

### 2.1 메이커-체커(Maker-Checker) 스타일

Agentic RAG는 "질의-검토-수정-재질의"라는 구조의 루프를 따릅니다. 이를 통해 다음과 같은 효과를 얻습니다:

- 정확성 향상: 결과를 검토하고, 불확실하거나 잘못된 질의는 다시 작성  
- 탄력성 확보: 오류나 실패 상황에서도 유연하게 대처  
- 효율적 자원 활용: 각 도구의 강점을 최대한 활용하며 반복 최소화  

### 2.2 추론의 자율성 (Self-directed Reasoning)

전통적 RAG 시스템은 사람이 설계한 프롬프트 체인에 따라 작동합니다. 그러나 Agentic RAG는 문제 해결 방식을 **스스로 결정**합니다.

예를 들어, "신제품 출시 전략을 세워라"라는 요청이 주어졌을 때:

1. Bing Web Grounding을 통해 시장 동향 조사  
2. Azure AI Search로 경쟁사 분석  
3. Azure SQL Database로 내부 매출 추이 확인  
4. 이 모든 정보를 Azure OpenAI Service로 통합 분석하여 전략 도출  
5. 전략의 결함 여부를 평가하고, 필요시 반복 수행  

모든 단계는 시스템이 **스스로 판단하여 순서를 구성**합니다.

### /2.3 도구 통합 및 상태 유지 (Tool Integration & Memory)

- 도구 선택: 상황에 맞춰 벡터 검색, SQL 쿼리, API 호출 등을 선택  
- 상태(State) 유지: 각 단계를 기억하고 활용하여 중복 반복 방지  
- 학습 기반 결정: 과거 시도들을 바탕으로 점점 더 정교한 판단 수행  

---

## 3장 자기 수정 및 실패 복구 전략

Agentic RAG는 단일 호출로 끝나는 일회성 시스템이 아닌, **진행 중 학습이 가능한 지능형 시스템**입니다.

### 3.1 반복 및 재질의 (Query Refinement in Action)

Agentic RAG는 단일 검색 결과에 만족하지 않고, **검색 품질을 평가하고 쿼리를 반복적으로 개선**하여 더 나은 정보를 얻기 위한 **지능적 루프 구조**를 따릅니다.

#### 결과 평가 (Result Assessment)

모델은 검색 결과를 다음과 같은 기준으로 평가합니다:

- 정보가 **질문과 충분히 관련이 있는가**  
- **데이터가 부족하거나 불완전**하지는 않은가  
- **중복된 정보**나 **모순된 내용**이 포함되어 있지는 않은가  
- 사용자 질의의 **전체 맥락을 커버하는가**

---

####  쿼리 재작성 (Query Reformulation)

필요하다고 판단되면, 모델은 쿼리를 재작성하여 검색 품질을 향상시킵니다. 예시:

- 원래 쿼리:  
  `sales trend of wearable devices`

- 개선된 쿼리:  
  `Q1 2023 global smartwatch sales trend site:statista.com`

- 개선 방법:  
  - **시간/지역 조건 추가**  
  - **구체적인 서브카테고리 지정 (예: smartwatch, fitness band 등)**  
  - **신뢰할 수 있는 출처(site:) 활용**  
  - **키워드 확장 또는 질문형 전환**

---

####  검색 방식 전환 (Retrieval Method Switching)

기존 검색이 효과적이지 않으면 다른 방식으로 전환합니다:

- 벡터 검색 → 키워드 검색  
- 웹 검색 API → 사내 SQL DB 질의  
- 문서 검색 → Knowledge Graph 또는 기능성 도구 사용 (예: 코드 실행)

---

####  도구 선택 최적화 (Dynamic Tool Selection)

Agentic 시스템은 다음과 같은 기준으로 **도구를 동적으로 선택**합니다:

| 요구 정보 | 선택 도구 |
|-----------|-----------|
| 최신 뉴스/동향 | Bing Web Search |
| 구조화된 정량 데이터 | Azure SQL Database |
| 기업 내부 문서 | Azure AI Search |
| 통계 리포트 | PDF 분석기, OCR, Table Extractor 등 |

---

####  실제 적용 예시

> 사용자: “지난 분기의 웨어러블 디바이스 수익 감소 원인을 분석해줘”

에이전트의 작동 흐름:

1. 초기 쿼리 생성:  
   `Q1 wearable device revenue drop reason`

2. 결과가 불충분하다고 판단 → 쿼리 재작성:  
   `smartwatch sales decline Q1 2023 site:counterpointresearch.com`

3. 여전히 부족할 경우 도구 전환:  
   - Azure SQL에서 내부 판매 데이터 분석  
   - Azure AI Search로 경쟁사 동향 수집

4. 결과 통합 후: 전략 분석 → 종합 응답 생성

---

이처럼 Agentic RAG는 단순히 검색 결과를 읽는 것이 아니라, **검색의 질을 평가하고 필요 시 능동적으로 방향을 전환**합니다. 이를 통해 **더 정확하고 풍부한 응답**을 생성할 수 있습니다.

### 3.2 진단 도구 사용

### /3.2 진단 도구 사용 (Using Diagnostic Tools)

Agentic RAG 시스템은 복잡한 검색 및 응답 생성 과정 중 발생할 수 있는 오류를 스스로 진단하고 수정하기 위한 다양한 도구를 활용할 수 있습니다. 이 과정은 사람이 개입하지 않아도, 모델이 **자기 추론(self-reasoning)** 흐름을 점검하고 보완하도록 설계되었습니다.

#### 로그 기반 진단

시스템은 각 단계에서 수행한 작업에 대해 **로그 기록 또는 추론 경로(trace)**를 남길 수 있습니다. 이 기록은 추후 오류 발생 시 분석을 위한 기반이 됩니다.

예:
- 어떤 쿼리를 언제 실행했는지
- 어떤 도구를 호출했는지
- 어떤 결과를 받았는지
- 결과의 신뢰도 또는 상태 판단

도구 예시:
- Azure AI Tracing
- LangChain Debugger
- Chainlit Observer
- OpenTelemetry 기반 로그 관리 시스템

---

#### 정확도 검증 (Correctness Checking)

검색 결과가 실제로 문제 해결에 적합한지, 혹은 LLM의 응답이 논리적으로 타당한지 **추론의 정확도 검증 단계**가 포함됩니다.

방법:
- 결과 내 핵심 정보가 질문에 포함된 핵심 조건을 충족하는지 확인
- 문서 내용과 응답의 일치 여부 비교
- 쿼리 결과가 이전 응답과 모순되는지 여부 판단

---

#### 도구 호출 예시

특정 도구를 사용해 문제를 진단하는 방식은 다음과 같습니다:

- 코드 생성 문제 → 코드 실행 도구로 오류 검출  
- SQL 생성 문제 → 데이터베이스에 직접 실행 후 에러 메시지 수집  
- 복잡한 문서 검색 → 키워드 기반 리트리버, OCR, Table Extractor, Chunk Evaluator 연동  
- 복수 결과 비교 → Majority Voting 또는 Reranker 사용

---

#### 다단계 디버깅 구조

Agentic RAG는 다음과 같은 다단계 구조로 추론을 진단합니다:

1. 초기 결과 분석: 신뢰도/일관성 체크  
2. 쿼리 재검토: 사용된 질의어, 범위 조건, 출처  
3. 도구 내부 로그 분석: API 응답 형식, 쿼리 처리 방식 확인  
4. 새 도구 대체 또는 재호출 결정

---

#### 활용 목적

- 응답 생성 실패의 원인 파악  
- 반복적인 오류 루프 방지  
- 추론 정확도 향상  
- 사용자 피드백 없이 스스로 개선 루틴 수행

이러한 진단 도구들은 Agentic RAG의 자율성을 유지하면서도, **정확도와 신뢰성 향상을 위한 핵심 구성 요소**로 작용합니다.
 

### /3.3 인간 개입

- 고위험/민감한 작업에서는 불확실성 신호를 감지하고 사람에게 피드백 요청  
- 사람의 교정 후, 해당 교훈을 시스템이 메모리로 흡수하여 향후 활용  

---

## /4장 에이전시의 한계 (Boundaries of Agency)

Agentic RAG는 AGI(인공 일반 지능)는 아니며, 명확한 제약 조건 하에서 자율성을 발휘합니다:

- 도메인 특화 자율성: 특정 분야 안에서만 전략적으로 판단  
- 인프라 의존성: 도구와 데이터셋은 개발자가 연동한 범위에 한정  
- 안전 가이드라인 준수: 윤리, 법률, 기업 정책 등에 따라 동작 제한  

---

## /5장 실전 활용 사례 (Practical Use Cases)

Agentic RAG는 다음과 같은 환경에서 탁월한 성능을 발휘합니다:

### /5.1 정확성 중심 환경

- 규제 분석, 법률 리뷰 등 검증된 정보가 필수인 분야  
- 여러 출처 확인, 반복 질의, 수정 루프를 통한 최종 검증  

### /5.2 복잡한 데이터베이스 상호작용

- 구조화된 데이터 상호작용 중 실패 쿼리 자동 보정  
- Azure SQL, Microsoft OneLake 등과 연동  

### /5.3 확장형 워크플로우

- 고객 응대, 프로젝트 관리 등 다단계 정보 흐름에 적합  
- 세션 중 새로운 데이터 반영 → 전략도 동적으로 조정  

---

## /6장 거버넌스, 투명성, 신뢰

Agentic 시스템의 자율성은 **책임성과 설명 가능성**을 전제로 해야 합니다:

### /6.1 설명 가능한 추론

- 질의, 출처, 결론 도달 과정을 감사 가능한 로그로 기록  
- Azure AI Tracing, GenAIOps 등 모니터링 도구 필요  

### /6.2 편향 통제 및 균형 검색

- 데이터 편향 방지를 위한 검색 전략 조정  
- Azure Machine Learning 기반 결과 감사 및 통계 검토  

### /6.3 인간의 감독

- 고위험 결정 시 인간 판단이 보완적으로 작동  
- 시스템은 옵션을 제시하는 **조력자(agent)** 역할  

---

## /7장 결론

Agentic RAG는 단순 생성 AI를 넘어, **상황 판단, 도구 조합, 반복 정제**가 가능한 **지능형 AI 프레임워크**입니다.

- 프롬프트에만 의존하지 않고, 능동적 검색과 도구 활용을 통해 문제를 해결  
- 반복적 상호작용과 자기 수정 능력으로 **정확하고 신뢰 가능한 응답 제공**  

이는 기업과 사용자 모두에게 **더 신뢰할 수 있는 AI**, **사람과 협력하는 스마트 에이전트**의 가능성을 제시합니다.

